<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Raporlar - S√ºt Takip Sistemi</title>
  <meta name="description" content="S√ºt √ºretimi raporlarƒ± ve analizleri">
  <link rel="manifest" href="/manifest.json">
  <link rel="icon" href="/icons/favicon.ico" type="image/x-icon">
  <meta name="theme-color" content="#4CAF50">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .container { 
      max-width: 1400px; 
      margin: auto; 
      background: white; 
      border-radius: 15px; 
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    .header {
      background: linear-gradient(135deg, #4CAF50, #45a049);
      color: white;
      padding: 30px;
      text-align: center;
      position: relative;
    }
    .header h1 { font-size: 2.5rem; margin-bottom: 10px; }
    .header p { opacity: 0.9; font-size: 1.1rem; }
    .back-btn {
      position: absolute;
      left: 30px;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(255,255,255,0.2);
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 8px;
      text-decoration: none;
      font-weight: bold;
      transition: background 0.3s;
    }
    .back-btn:hover {
      background: rgba(255,255,255,0.3);
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      padding: 30px;
      background: #f8f9fa;
    }
    .stat-card {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      padding: 25px;
      border-radius: 12px;
      text-align: center;
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
      transition: transform 0.3s;
    }
    .stat-card:hover {
      transform: translateY(-5px);
    }
    .stat-number {
      font-size: 2.5rem;
      font-weight: bold;
      margin-bottom: 8px;
    }
    .stat-label {
      opacity: 0.9;
      font-size: 0.9rem;
    }
    
    .filter-section {
      background: #f8f9fa;
      padding: 30px;
      border-bottom: 1px solid #e1e5e9;
    }
    .filter-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }
    .form-group {
      display: flex;
      flex-direction: column;
    }
    .form-group label {
      font-weight: 600;
      margin-bottom: 8px;
      color: #333;
    }
    .form-group select,
    .form-group input {
      padding: 12px;
      border: 2px solid #e1e5e9;
      border-radius: 8px;
      font-size: 1rem;
      transition: border-color 0.3s;
    }
    .form-group select:focus,
    .form-group input:focus {
      outline: none;
      border-color: #4CAF50;
    }
    
    .btn {
      background: linear-gradient(135deg, #4CAF50, #45a049);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      transition: transform 0.2s, box-shadow 0.2s;
      margin: 5px;
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 15px rgba(76, 175, 80, 0.3);
    }
    .btn-secondary {
      background: linear-gradient(135deg, #6c757d, #5a6268);
    }
    .btn-danger {
      background: linear-gradient(135deg, #dc3545, #c82333);
    }
    
    .data-section {
      padding: 30px;
    }
    .search-box {
      width: 100%;
      padding: 12px;
      border: 2px solid #e1e5e9;
      border-radius: 8px;
      margin-bottom: 20px;
      font-size: 1rem;
    }
    .data-table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .data-table th,
    .data-table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #e1e5e9;
    }
    .data-table th {
      background: #4CAF50;
      color: white;
      font-weight: 600;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .data-table tr:nth-child(even) {
      background: #f8f9fa;
    }
    .data-table tr:hover {
      background: #e8f5e8;
    }
    
    .chart-section {
      padding: 30px;
      background: white;
    }
    .chart-container {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }
    .chart-title {
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 15px;
      color: #333;
    }
    
    .no-data {
      text-align: center;
      padding: 50px;
      color: #666;
      font-size: 1.1rem;
    }
    
    .export-section {
      padding: 20px 30px;
      background: #f8f9fa;
      border-top: 1px solid #e1e5e9;
      text-align: center;
    }
    
    @media (max-width: 768px) {
      .filter-grid { grid-template-columns: 1fr; }
      .stats-grid { grid-template-columns: 1fr; }
      .header h1 { font-size: 1.8rem; }
      .back-btn { position: static; margin-bottom: 10px; }
      .data-table { font-size: 0.9rem; }
      .data-table th,
      .data-table td { padding: 8px; }
    }
    
    .loading {
      text-align: center;
      padding: 50px;
      font-size: 1.1rem;
      color: #666;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <a href="/" class="back-btn">üîô Ana Sayfa</a>
      <h1>üìä S√ºt √úretimi Raporlarƒ±</h1>
      <p>Detaylƒ± analiz ve raporlama paneli</p>
    </div>
    
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-number" id="toplam-uretim">0</div>
        <div class="stat-label">Toplam √úretim (L)</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="gunluk-ortalama">0</div>
        <div class="stat-label">G√ºnl√ºk Ortalama (L)</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="aktif-uretici">0</div>
        <div class="stat-label">Aktif √úretici</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="toplam-kayit">0</div>
        <div class="stat-label">Toplam Kayƒ±t</div>
      </div>
    </div>
    
    <div class="filter-section">
      <h3>Filtreler</h3>
      <div class="filter-grid">
        <div class="form-group">
          <label for="filtre-koy">K√∂y:</label>
          <select id="filtre-koy" onchange="raporlariFiltrele()">
            <option value="">T√ºm√º</option>
            <option value="Yuvalƒ±">Yuvalƒ±</option>
            <option value="Karap√ºr√ßek">Karap√ºr√ßek</option>
            <option value="Edirk√∂y">Edirk√∂y</option>
            <option value="Kavacƒ±k">Kavacƒ±k</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="filtre-musta">M√ºstahsil:</label>
          <select id="filtre-musta" onchange="raporlariFiltrele()">
            <option value="">T√ºm√º</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="baslangic-tarih">Ba≈ülangƒ±√ß Tarihi:</label>
          <input type="date" id="baslangic-tarih" onchange="raporlariFiltrele()">
        </div>
        
        <div class="form-group">
          <label for="bitis-tarih">Biti≈ü Tarihi:</label>
          <input type="date" id="bitis-tarih" onchange="raporlariFiltrele()">
        </div>
      </div>
      
      <div style="margin-top: 15px;">
        <button class="btn" onclick="raporlariFiltrele()">üîç Filtrele</button>
        <button class="btn btn-secondary" onclick="filtreleriTemizle()">üßπ Temizle</button>
        <button class="btn btn-secondary" onclick="bugunRaporu()">üìÖ Bug√ºn</button>
        <button class="btn btn-secondary" onclick="haftaRaporu()">üìÖ Bu Hafta</button>
        <button class="btn btn-secondary" onclick="ayRaporu()">üìÖ Bu Ay</button>
      </div>
    </div>
    
    <div class="chart-section">
      <div class="chart-container">
        <div class="chart-title">G√ºnl√ºk √úretim Trendi (Son 7 G√ºn)</div>
        <canvas id="trendGrafik" width="800" height="300"></canvas>
      </div>
      
      <div class="chart-container">
        <div class="chart-title">K√∂y Bazƒ±nda √úretim Daƒüƒ±lƒ±mƒ±</div>
        <canvas id="dagƒ±lƒ±mGrafik" width="800" height="300"></canvas>
      </div>
    </div>
    
    <div class="data-section">
      <h3>Veri Tablosu</h3>
      <input type="text" id="arama" class="search-box" placeholder="üîç Ara... (m√ºstahsil adƒ±, k√∂y, tarih)" oninput="tabloAra()">
      
      <div style="overflow-x: auto;">
        <table class="data-table" id="raporTablosu">
          <thead>
            <tr>
              <th onclick="tabloSirala('tarih')">Tarih ‚ÜïÔ∏è</th>
              <th onclick="tabloSirala('koy')">K√∂y ‚ÜïÔ∏è</th>
              <th onclick="tabloSirala('musta')">M√ºstahsil ‚ÜïÔ∏è</th>
              <th onclick="tabloSirala('ogun')">√ñƒü√ºn ‚ÜïÔ∏è</th>
              <th onclick="tabloSirala('miktar')">Miktar (L) ‚ÜïÔ∏è</th>
              <th>ƒ∞≈ülemler</th>
            </tr>
          </thead>
          <tbody id="tabloIcerik">
            <tr>
              <td colspan="6" class="loading">Veriler y√ºkleniyor...</td>
            </tr>
          </tbody>
        </table>
      </div>
      
      <div id="veriYok" class="no-data" style="display: none;">
        <h3>üì≠ Veri Bulunamadƒ±</h3>
        <p>Se√ßilen kriterlere uygun veri bulunmamaktadƒ±r.</p>
        <button class="btn" onclick="window.location.href='/'">‚ûï Yeni Kayƒ±t Ekle</button>
      </div>
    </div>
    
    <div class="export-section">
      <h3>Dƒ±≈üa Aktarma</h3>
      <button class="btn" onclick="csvIndir()">üìÑ CSV ƒ∞ndir</button>
      <button class="btn" onclick="excelIndir()">üìä Excel ƒ∞ndir</button>
      <button class="btn" onclick="pdfOlustur()">üìë PDF Rapor</button>
      <button class="btn btn-secondary" onclick="yazdƒ±r()">üñ®Ô∏è Yazdƒ±r</button>
    </div>
  </div>
  
  <script>
    // Global deƒüi≈ükenler
    let sutVerileri = JSON.parse(localStorage.getItem('sutVerileri') || '[]');
    let filtreliVeriler = [...sutVerileri];
    let siralamaDurumu = { alan: '', y√∂n: 'asc' };
    
    const MUSTAHSIL_LISTESI = {
      "Yuvalƒ±": ["Ayhan","S√ºleyman","Engin","Selahattin","Nevzat","G√∂kmen","A. G√∂kdaƒü","H√ºsn√º","ƒ∞smail","Emine","Berrin","Bayramalƒ±","Kemal","≈û√ºkriye Can","ƒ∞. Duraklƒ±","M. Bayraktar","Mithat","Necati","A. Yal√ßƒ±n","Bilgin","Necami","H. B√ºyer","A. Y√ºksel","Ergin"],
      "Karap√ºr√ßek": ["Ahmet","Emrah","√úmit","Ender","Mehmet","Okan","Hakan","Cemalettin","Hulisi","Fikret"],
      "Edirk√∂y": ["H. Boz","Nadir","Nejat","A. Durmu≈ü","√ñ. Durmu≈ü","Harun","R√ºstem","√úsret","Sevim","G√ºray","A. Kahveci","A. √áetin","Nazlƒ±","Rasit","Zerrin"],
      "Kavacƒ±k": ["C. Ka√ßan","ƒ∞t. Kontor","M√ºkrinat","M. Yƒ±ldƒ±z","M. ≈ûahin","Zeki","Vasif","S. Ayalƒ±n","Sevgi","A. Aydƒ±n","M. Aydƒ±n"]
    };
    
    // Sayfa y√ºklendiƒüinde
    document.addEventListener('DOMContentLoaded', function() {
      mustahsilListesiniDoldur();
      tarihFiltreleriniAyarla();
      istatistikleriHesapla();
      raporlariFiltrele();
      grafikleriCiz();
      
      // Service Worker kayƒ±t
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/service-worker.js');
      }
    });
    
    // M√ºstahsil listesini doldur
    function mustahsilListesiniDoldur() {
      const select = document.getElementById('filtre-musta');
      const tumMustahsiller = new Set();
      
      Object.values(MUSTAHSIL_LISTESI).forEach(liste => {
        liste.forEach(ad => tumMustahsiller.add(ad));
      });
      
      Array.from(tumMustahsiller).sort().forEach(ad => {
        const option = document.createElement('option');
        option.value = ad;
        option.textContent = ad;
        select.appendChild(option);
      });
    }
    
    // Tarih filtrelerini ayarla
    function tarihFiltreleriniAyarla() {
      const bugun = new Date().toISOString().split('T')[0];
      const ayOnce = new Date(Date.now() - 30*24*60*60*1000).toISOString().split('T')[0];
      
      document.getElementById('baslangic-tarih').value = ayOnce;
      document.getElementById('bitis-tarih').value = bugun;
    }
    
    // ƒ∞statistikleri hesapla
    function istatistikleriHesapla() {
      const toplamUretim = filtreliVeriler.reduce((sum, v) => sum + v.miktar, 0);
      const gunSayisi = new Set(filtreliVeriler.map(v => v.tarih)).size || 1;
      const gunlukOrtalama = toplamUretim / gunSayisi;
      const aktifUretici = new Set(filtreliVeriler.map(v => v.musta)).size;
      
      document.getElementById('toplam-uretim').textContent = toplamUretim.toFixed(1);
      document.getElementById('gunluk-ortalama').textContent = gunlukOrtalama.toFixed(1);
      document.getElementById('aktif-uretici').textContent = aktifUretici;
      document.getElementById('toplam-kayit').textContent = filtreliVeriler.length;
    }
    
    // Raporlarƒ± filtrele
    function raporlariFiltrele() {
      const koy = document.getElementById('filtre-koy').value;
      const musta = document.getElementById('filtre-musta').value;
      const baslangic = document.getElementById('baslangic-tarih').value;
      const bitis = document.getElementById('bitis-tarih').value;
      
      filtreliVeriler = sutVerileri.filter(veri => {
        let uygun = true;
        
        if (koy && veri.koy !== koy) uygun = false;
        if (musta && veri.musta !== musta) uygun = false;
        if (baslangic && veri.tarih < baslangic) uygun = false;
        if (bitis && veri.tarih > bitis) uygun = false;
        
        return uygun;
      });
      
      istatistikleriHesapla();
      tabloGuncelle();
      grafikleriCiz();
    }
    
    // Tabloyu g√ºncelle
    function tabloGuncelle() {
      const tbody = document.getElementById('tabloIcerik');
      const veriYokDiv = document.getElementById('veriYok');
      
      if (filtreliVeriler.length === 0) {
        tbody.innerHTML = '';
        veriYokDiv.style.display = 'block';
        return;
      }
      
      veriYokDiv.style.display = 'none';
      
      // Sƒ±ralama uygula
      if (siralamaDurumu.alan) {
        filtreliVeriler.sort((a, b) => {
          let aVal = a[siralamaDurumu.alan];
          let bVal = b[siralamaDurumu.alan];
          
          if (typeof aVal === 'string') {
            aVal = aVal.toLowerCase();
            bVal = bVal.toLowerCase();
          }
          
          if (siralamaDurumu.y√∂n === 'asc') {
            return aVal < bVal ? -1 : aVal > bVal ? 1 : 0;
          } else {
            return aVal > bVal ? -1 : aVal < bVal ? 1 : 0;
          }
        });
      }
      
      tbody.innerHTML = filtreliVeriler.map(veri => `
        <tr>
          <td>${veri.tarih}</td>
          <td>${veri.koy}</td>
          <td>${veri.musta}</td>
          <td>${veri.ogun === 'Sabah' ? 'üåÖ' : 'üåÜ'} ${veri.ogun}</td>
          <td><strong>${veri.miktar.toFixed(1)}</strong></td>
          <td>
            <button class="btn btn-danger" style="padding: 5px 10px; font-size: 0.8rem;" 
                    onclick="kayitSil(${veri.id})">üóëÔ∏è</button>
          </td>
        </tr>
      `).join('');
    }
    
    // Tablo sƒ±ralama
    function tabloSirala(alan) {
      if (siralamaDurumu.alan === alan) {
        siralamaDurumu.y√∂n = siralamaDurumu.y√∂n === 'asc' ? 'desc' : 'asc';
      } else {
        siralamaDurumu.alan = alan;
        siralamaDurumu.y√∂n = 'asc';
      }
      
      tabloGuncelle();
    }
    
    // Tablo arama
    function tabloAra() {
      const arama = document.getElementById('arama').value.toLowerCase();
      const satirlar = document.querySelectorAll('#tabloIcerik tr');
      
      satirlar.forEach(satir => {
        const metin = satir.textContent.toLowerCase();
        satir.style.display = metin.includes(arama) ? '' : 'none';
      });
    }
    
    // Kayƒ±t silme
    function kayitSil(id) {
      if (confirm('Bu kaydƒ± silmek istediƒüinizden emin misiniz?')) {
        sutVerileri = sutVerileri.filter(v => v.id !== id);
        localStorage.setItem('sutVerileri', JSON.stringify(sutVerileri));
        raporlariFiltrele();
        alert('Kayƒ±t silindi.');
      }
    }
    
    // Hƒ±zlƒ± filtreler
    function bugunRaporu() {
      const bugun = new Date().toISOString().split('T')[0];
      document.getElementById('baslangic-tarih').value = bugun;
      document.getElementById('bitis-tarih').value = bugun;
      raporlariFiltrele();
    }
    
    function haftaRaporu() {
      const bugun = new Date().toISOString().split('T')[0];
      const haftaOnce = new Date(Date.now() - 7*24*60*60*1000).toISOString().split('T')[0];
      document.getElementById('baslangic-tarih').value = haftaOnce;
      document.getElementById('bitis-tarih').value = bugun;
      raporlariFiltrele();
    }
    
    function ayRaporu() {
      const bugun = new Date().toISOString().split('T')[0];
      const ayOnce = new Date(Date.now() - 30*24*60*60*1000).toISOString().split('T')[0];
      document.getElementById('baslangic-tarih').value = ayOnce;
      document.getElementById('bitis-tarih').value = bugun;
      raporlariFiltrele();
    }
    
    // Filtreleri temizle
    function filtreleriTemizle() {
      document.getElementById('filtre-koy').value = '';
      document.getElementById('filtre-musta').value = '';
      tarihFiltreleriniAyarla();
      raporlariFiltrele();
    }
    
    // Grafikleri √ßiz
    function grafikleriCiz() {
      trendGrafigiCiz();
      dagƒ±lƒ±mGrafigiCiz();
    }
    
    // Trend grafiƒüi
    function trendGrafigiCiz() {
      const canvas = document.getElementById('trendGrafik');
      const ctx = canvas.getContext('2d');
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      // Son 7 g√ºn√ºn verilerini hazƒ±rla
      const son7Gun = [];
      for (let i = 6; i >= 0; i--) {
        const tarih = new Date(Date.now() - i*24*60*60*1000).toISOString().split('T')[0];
        const gunToplam = filtreliVeriler
          .filter(v => v.tarih === tarih)
          .reduce((sum, v) => sum + v.miktar, 0);
        son7Gun.push({ tarih, miktar: gunToplam });
      }
      
      if (son7Gun.every(g => g.miktar === 0)) {
        ctx.fillStyle = '#666';
        ctx.font = '16px Arial';
        ctx.textAlign = 'center';
        ctx.fillText('Veri bulunamadƒ±', canvas.width/2, canvas.height/2);
        return;
      }
      
      // Grafik √ßizimi
      const padding = 60;
      const genislik = canvas.width - 2 * padding;
      const yukseklik = canvas.height - 2 * padding;
      const maxMiktar = Math.max(...son7Gun.map(g => g.miktar), 1);
      
      // Eksenler
      ctx.strokeStyle = '#ddd';
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.moveTo(padding, padding);
      ctx.lineTo(padding, canvas.height - padding);
      ctx.lineTo(canvas.width - padding, canvas.height - padding);
      ctx.stroke();
      
      // √áizgi grafiƒüi
      ctx.strokeStyle = '#4CAF50';
      ctx.lineWidth = 3;
      ctx.beginPath();
      
      son7Gun.forEach((gun, index) => {
        const x = padding + (index * genislik / 6);
        const y = canvas.height - padding - (gun.miktar / maxMiktar * yukseklik);
        
        if (index === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
        
        // Nokta
        ctx.save();
        ctx.fillStyle = '#4CAF50';
        ctx.beginPath();
        ctx.arc(x, y, 5, 0, 2 * Math.PI);
        ctx.fill();
        ctx.restore();
        
        // Tarih etiketi
        ctx.save();
        ctx.fillStyle = '#666';
        ctx.font = '12px Arial';
        ctx.textAlign = 'center';
        const tarihKisa = gun.tarih.split('-')[2] + '/' + gun.tarih.split('-')[1];
        ctx.fillText(tarihKisa, x, canvas.height - padding + 20);
        
        // Deƒüer etiketi
        ctx.fillText(gun.miktar.toFixed(1) + 'L', x, y - 10);
        ctx.restore();
      });
      
      ctx.stroke();
      
      // Y ekseni etiketleri
      ctx.fillStyle = '#666';
      ctx.font = '12px Arial';
      ctx.textAlign = 'right';
      for (let i = 0; i <= 5; i++) {
        const y = canvas.height - padding - (i * yukseklik / 5);
        const deger = (maxMiktar * i / 5).toFixed(0);
        ctx.fillText(deger + 'L', padding - 10, y + 4);
      }
    }
    
    // Daƒüƒ±lƒ±m grafiƒüi
    function dagƒ±lƒ±mGrafigiCiz() {
      const canvas = document.getElementById('dagƒ±lƒ±mGrafik');
      const ctx = canvas.getContext('2d');
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      // K√∂y bazƒ±nda toplam √ºretim
      const koyVerileri = {};
      filtreliVeriler.forEach(veri => {
        if (!koyVerileri[veri.koy]) {
          koyVerileri[veri.koy] = 0;
        }
        koyVerileri[veri.koy] += veri.miktar;
      });
      
      const koyler = Object.keys(koyVerileri);
      if (koyler.length === 0) {
        ctx.fillStyle = '#666';
        ctx.font = '16px Arial';
        ctx.textAlign = 'center';
        ctx.fillText('Veri bulunamadƒ±', canvas.width/2, canvas.height/2);
        return;
      }
      
      const renkler = ['#4CAF50', '#2196F3', '#FF9800', '#9C27B0'];
      const padding = 60;
      const barGenislik = (canvas.width - 2 * padding) / koyler.length * 0.8;
      const maxDeger = Math.max(...Object.values(koyVerileri));
      const grafik_yukseklik = canvas.height - 2 * padding;
      
      // Eksenler
      ctx.strokeStyle = '#ddd';
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.moveTo(padding, padding);
      ctx.lineTo(padding, canvas.height - padding);
      ctx.lineTo(canvas.width - padding, canvas.height - padding);
      ctx.stroke();
      
      // Barlar
      koyler.forEach((koy, index) => {
        const x = padding + (index * (canvas.width - 2 * padding) / koyler.length) + 
                  ((canvas.width - 2 * padding) / koyler.length - barGenislik) / 2;
        const barYukseklik = (koyVerileri[koy] / maxDeger) * grafik_yukseklik;
        const y = canvas.height - padding - barYukseklik;
        
        // Bar √ßiz
        ctx.fillStyle = renkler[index % renkler.length];
        ctx.fillRect(x, y, barGenislik, barYukseklik);
        
        // Kenarlƒ±k
        ctx.strokeStyle = '#fff';
        ctx.lineWidth = 2;
        ctx.strokeRect(x, y, barGenislik, barYukseklik);
        
        // K√∂y adƒ±
        ctx.fillStyle = '#666';
        ctx.font = '14px Arial';
        ctx.textAlign = 'center';
        ctx.fillText(koy, x + barGenislik/2, canvas.height - padding + 20);
        
        // Deƒüer
        ctx.fillStyle = '#fff';
        ctx.font = 'bold 12px Arial';
        ctx.fillText(koyVerileri[koy].toFixed(1) + 'L', x + barGenislik/2, y + 20);
      });
      
      // Y ekseni etiketleri
      ctx.fillStyle = '#666';
      ctx.font = '12px Arial';
      ctx.textAlign = 'right';
      for (let i = 0; i <= 5; i++) {
        const y = canvas.height - padding - (i * grafik_yukseklik / 5);
        const deger = (maxDeger * i / 5).toFixed(0);
        ctx.fillText(deger + 'L', padding - 10, y + 4);
      }
    }
    
    // CSV indirme
    function csvIndir() {
      if (filtreliVeriler.length === 0) {
        alert('ƒ∞ndirilecek veri bulunmamaktadƒ±r.');
        return;
      }
      
      const csvIcerik = [
        ["Tarih", "K√∂y", "M√ºstahsil", "√ñƒü√ºn", "Miktar (L)"],
        ...filtreliVeriler.map(v => [
          v.tarih, v.koy, v.musta, v.ogun, v.miktar
        ])
      ];
      
      const csvString = csvIcerik.map(row => row.join(",")).join("\n");
      const blob = new Blob(["\uFEFF" + csvString], { type: 'text/csv;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      
      const a = document.createElement('a');
      a.href = url;
      a.download = `sut_raporu_${new Date().toISOString().split('T')[0]}.csv`;
      a.click();
      URL.revokeObjectURL(url);
    }
    
    // Excel indirme
    function excelIndir() {
      if (filtreliVeriler.length === 0) {
        alert('ƒ∞ndirilecek veri bulunmamaktadƒ±r.');
        return;
      }
      
      // Basit Excel formatƒ± (XML tabanlƒ±)
      let excelContent = `<?xml version="1.0"?>
<Workbook xmlns="urn:schemas-microsoft-com:office:spreadsheet" 
          xmlns:o="urn:schemas-microsoft-com:office:office" 
          xmlns:x="urn:schemas-microsoft-com:office:excel" 
          xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet" 
          xmlns:html="http://www.w3.org/TR/REC-html40">
<Worksheet ss:Name="S√ºt Raporu">
<Table>
<Row>
  <Cell><Data ss:Type="String">Tarih</Data></Cell>
  <Cell><Data ss:Type="String">K√∂y</Data></Cell>
  <Cell><Data ss:Type="String">M√ºstahsil</Data></Cell>
  <Cell><Data ss:Type="String">√ñƒü√ºn</Data></Cell>
  <Cell><Data ss:Type="String">Miktar (L)</Data></Cell>
</Row>`;
      
      filtreliVeriler.forEach(v => {
        excelContent += `
<Row>
  <Cell><Data ss:Type="String">${v.tarih}</Data></Cell>
  <Cell><Data ss:Type="String">${v.koy}</Data></Cell>
  <Cell><Data ss:Type="String">${v.musta}</Data></Cell>
  <Cell><Data ss:Type="String">${v.ogun}</Data></Cell>
  <Cell><Data ss:Type="Number">${v.miktar}</Data></Cell>
</Row>`;
      });
      
      excelContent += `
</Table>
</Worksheet>
</Workbook>`;
      
      const blob = new Blob([excelContent], { type: 'application/vnd.ms-excel' });
      const url = URL.createObjectURL(blob);
      
      const a = document.createElement('a');
      a.href = url;
      a.download = `sut_raporu_${new Date().toISOString().split('T')[0]}.xls`;
      a.click();
      URL.revokeObjectURL(url);
    }
    
    // PDF olu≈üturma
    function pdfOlustur() {
      if (filtreliVeriler.length === 0) {
        alert('PDF olu≈üturmak i√ßin veri bulunmamaktadƒ±r.');
        return;
      }
      
      const tarih = new Date().toLocaleDateString('tr-TR');
      const baslangic = document.getElementById('baslangic-tarih').value;
      const bitis = document.getElementById('bitis-tarih').value;
      
      let htmlIcerik = `
        <html>
        <head>
          <meta charset="UTF-8">
          <title>S√ºt √úretimi Raporu</title>
          <style>
            body { font-family: Arial, sans-serif; margin: 20px; }
            h1 { color: #4CAF50; text-align: center; margin-bottom: 30px; }
            .info { margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 5px; }
            .stats { display: flex; justify-content: space-around; margin: 20px 0; }
            .stat-box { text-align: center; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
            .stat-number { font-size: 1.5em; font-weight: bold; color: #4CAF50; }
            table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 12px; }
            th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
            th { background-color: #4CAF50; color: white; }
            tr:nth-child(even) { background-color: #f8f9fa; }
            .footer { margin-top: 30px; text-align: center; color: #666; font-size: 12px; }
          </style>
        </head>
        <body>
          <h1>ü•õ S√ºt √úretimi Raporu</h1>
          
          <div class="info">
            <p><strong>Rapor Tarihi:</strong> ${tarih}</p>
            <p><strong>D√∂nem:</strong> ${baslangic} - ${bitis}</p>
            <p><strong>Toplam Kayƒ±t:</strong> ${filtreliVeriler.length}</p>
          </div>
          
          <div class="stats">
            <div class="stat-box">
              <div class="stat-number">${document.getElementById("toplam-uretim").textContent}</div>
              <div>Toplam √úretim (L)</div>
            </div>
            <div class="stat-box">
              <div class="stat-number">${document.getElementById("gunluk-ortalama").textContent}</div>
              <div>G√ºnl√ºk Ortalama (L)</div>
            </div>
            <div class="stat-box">
              <div class="stat-number">${document.getElementById("aktif-uretici").textContent}</div>
              <div>Aktif √úretici</div>
            </div>
            <div class="stat-box">
              <div class="stat-number">${document.getElementById("toplam-kayit").textContent}</div>
              <div>Toplam Kayƒ±t</div>
            </div>
          </div>
          
          <table>
            <thead>
              <tr>
                <th>Tarih</th>
                <th>K√∂y</th>
                <th>M√ºstahsil</th>
                <th>√ñƒü√ºn</th>
                <th>Miktar (L)</th>
              </tr>
            </thead>
            <tbody>
      `;
      
      filtreliVeriler.forEach(v => {
        htmlIcerik += `
          <tr>
            <td>${v.tarih}</td>
            <td>${v.koy}</td>
            <td>${v.musta}</td>
            <td>${v.ogun}</td>
            <td>${v.miktar.toFixed(1)}</td>
          </tr>
        `;
      });
      
      htmlIcerik += `
            </tbody>
          </table>
          
          <div class="footer">
            <p>Bu rapor S√ºt Takip Sistemi tarafƒ±ndan otomatik olarak olu≈üturulmu≈ütur.</p>
            <p>Olu≈üturulma Zamanƒ±: ${new Date().toLocaleString('tr-TR')}</p>
          </div>
        </body>
        </html>
      `;
      
      const yeniPencere = window.open('', '_blank');
      yeniPencere.document.write(htmlIcerik);
      yeniPencere.document.close();
      yeniPencere.print();
    }
    
    // Yazdƒ±rma
    function yazdƒ±r() {
      window.print();
    }
    
    // Veri g√ºncelleme kontrol√º
    function veriGuncellemeKontrol() {
      const yeniVeriler = JSON.parse(localStorage.getItem('sutVerileri') || '[]');
      if (yeniVeriler.length !== sutVerileri.length) {
        sutVerileri = yeniVeriler;
        raporlariFiltrele();
      }
    }
    
    // 30 saniyede bir veri kontrol√º
    setInterval(veriGuncellemeKontrol, 30000);
    
    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
      if (e.ctrlKey && e.key === 'f') {
        e.preventDefault();
        document.getElementById('arama').focus();
      }
      if (e.ctrlKey && e.key === 'p') {
        e.preventDefault();
        yazdƒ±r();
      }
      if (e.ctrlKey && e.key === 's') {
        e.preventDefault();
        csvIndir();
      }
    });
    
    console.log("üìä S√ºt Takip Rapor Paneli v2.1 y√ºklendi!");
  </script>
</body>
</html>
